version: "3.8"

services:
  hive-metastore-db:
    image: postgres:13
    container_name: hive-metastore-db
    restart: always
    environment:
      POSTGRES_USER: hive
      POSTGRES_PASSWORD: hive
      POSTGRES_DB: metastore
    ports:
      - "5432:5432"
    networks:
      - hadoop

  hive-metastore:
    image: bde2020/hive:2.3.2-postgresql-metastore
    container_name: hive-metastore
    restart: always
    depends_on:
      - hive-metastore-db
      - namenode
    environment:
      HIVE_METASTORE_DB_HOSTNAME: hive-metastore-db
      HIVE_METASTORE_DB_NAME: metastore
      HIVE_METASTORE_DB_USERNAME: hive
      HIVE_METASTORE_DB_PASSWORD: hive
    volumes:
      - ./hive/conf/hive-site.xml:/opt/hive/conf/hive-site.xml:ro
    ports:
      - "9083:9083"
    networks:
      - hadoop

  hive-server:
    image: bde2020/hive:2.3.2-postgresql-metastore
    container_name: hive-server
    restart: always
    depends_on:
      - hive-metastore
      - namenode
      - datanode1
      - datanode2
    environment:
      HIVE_METASTORE_URI: thrift://hive-metastore:9083
      HIVE_EXECUTION_ENGINE: mr
    volumes:
      - ./hive/conf/hive-site.xml:/opt/hive/conf/hive-site.xml:ro
    ports:
      - "10000:10000"
    networks:
      - hadoop

volumes:
# optional named volumes

networks:
  hadoop:
    driver: bridge
